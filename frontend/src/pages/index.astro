---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import LoginForm from '../components/LoginForm.astro';
import SignupForm from '../components/SignupForm.astro';
import AddressBook from '../components/AddressBook.astro';

const crypto = await import('node:crypto');
const nonce = crypto.randomBytes(16).toString('base64');

const isDev = import.meta.env.DEV;
const scriptSrc = isDev
  ? "'self' 'unsafe-inline'"
  : `'self' 'nonce-${nonce}'`;
const styleSrc = "'self'" + (isDev ? " 'unsafe-inline'" : "");

Astro.response.headers.set('Content-Security-Policy', `default-src 'self'; script-src ${scriptSrc}; style-src ${styleSrc}; connect-src 'self' http://localhost:8000; img-src 'self' data:; font-src 'self';`);
Astro.response.headers.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains; preload');
---

<BaseLayout>
  <Header />
  
  <div class="content">
    <div id="alertContainer"></div>
    
    <LoginForm />
    <SignupForm />
    <AddressBook />
  </div>

  <script type="module" src="./index-script.js" nonce={nonce}></script>
</BaseLayout>
